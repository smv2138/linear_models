---
title: "Bootstrapping"
output: github_document
---
```{r}
library(tidyverse)
library(modelr)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = 0.6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

## all plots i make will have the viridis color palette
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

## Simulate Data

```{r}
n_samp = 250

sim_df_const = 
  tibble(
    x = rnorm(n_samp, 1, 1),
    error = rnorm(n_samp, 0, 1),
    y = 2 + 3 * x + error
  )

#new error structure
sim_df_nonconst = sim_df_const %>% 
  mutate(
  error = error * .75 * x,
  y = 2 + 3 * x + error
)
```

Plot the datasets

Shows linear line 
residuals have constant variance (good for most assumptions of simple linear regression)
```{r}
sim_df_const %>% 
  ggplot(aes(x = x, y = y)) +
  geom_point() +
  geom_smooth(method = "lm")
```


Doesn't meet assumptions well 
Residuals spread out later on (heteroscedasticty)
Can solve this with a bootstrap
```{r}
sim_df_nonconst %>% 
  ggplot(aes(x = x, y = y)) +
  geom_point() +
  geom_smooth(method = "lm")
```

Fit linear regs for both dataset
```{r}
lm(y ~ x, data = sim_df_const) %>% broom::tidy()

lm(y ~ x, data = sim_df_nonconst) %>% broom::tidy()
```


## Draw 1 Bootstrap sample
Assumptions aren't met in the nonconst data set (understand what the distribution of intercepts are slope are in repeated sampling) - find actual slope and intercept through repeated sample
We don't trust the CI and the uncertainity estimates that go along with it

`sample_frac` draws a sample of a particular proportion from your dataset (by default with grab a sample that is proportional (1:1) proportion with the size of the dataset)
We want it to be the same size because CI are very dependent on the sample size

`arrange` because we know the df we're passing through will have an x and y and we want them arranged that way
```{r}
boot_samp = function(df) {
  
  sample_frac(df, size = 1, replace = TRUE) %>% 
    arrange(x)
  
}
```

Check if the function works

Some observations are coming in twice 
Darker points signify that those values appear multiple times in the dataset due to replacement
```{r}
boot_samp(sim_df_nonconst) %>% 
  ggplot(aes(x = x, y = y)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm")
```

Fit a regression with the bootstrap samples
```{r}
boot_samp(sim_df_nonconst) %>% 
  lm(y ~ x, data = .) %>% 
  broom::tidy()
```










